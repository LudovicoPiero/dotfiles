# =======================================================================================
# MONITOR CONFIG
# =======================================================================================
monitorv2 {
  output = HDMI-A-1
  mode = 1920x1080@180
  position = auto
  scale = 1
  # cm = dcip3
  supports_hdr = true
  supports_wide_color = true
  bitdepth = 10
}

monitorv2 {
  output = eDP-1
  disabled = true
}

# =======================================================================================
# ENVIRONMENT VARIABLES
# =======================================================================================
# QT / Toolkit overrides
env = QT_QPA_PLATFORM,wayland;xcb
env = GDK_BACKEND,wayland,x11,*
env = SDL_VIDEODRIVER,wayland
env = CLUTTER_BACKEND,wayland

# XDG Specs
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland

# Theming
env = HYPRCURSOR_THEME,Future-Cyan-Hyprcursor_Theme
env = XCURSOR_THEME,Future-Cyan-Hyprcursor_Theme
env = HYPRCURSOR_SIZE,24
env = XCURSOR_SIZE,24

# Input Method Environment Variables
# env = GTK_IM_MODULE,fcitx
env = QT_IM_MODULE,fcitx
env = XMODIFIERS,@im=fcitx
env = QT_IM_MODULES,"wayland;fcitx"

# =======================================================================================
# AUTOSTART (EXEC-ONCE)
# =======================================================================================

# Portals: Must be restarted to pick up the env vars
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = pkill -9 xdg-desktop-portal-wlr xdg-desktop-portal-gtk xdg-desktop-portal pipewire wireplumber pipewire-pulse mpd
exec-once = sleep 1 && /usr/libexec/xdg-desktop-portal-wlr &
exec-once = sleep 2 && /usr/libexec/xdg-desktop-portal-gtk &
exec-once = sleep 2 && /usr/libexec/xdg-desktop-portal &

# Cleanup & Audio Stack
exec-once = gentoo-pipewire-launcher &
exec-once = sleep 1 && mpd &
exec-once = sleep 1 && mpd-mpris &


# Clipboard Persist
exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --type image --watch cliphist store

# Authentication Agent (Polkit)
exec-once = /usr/libexec/polkit-gnome-authentication-agent-1

# Set cursor
exec-once = hyprctl setcursor Future-Cyan-Hyprcursor_Theme 24

# Autostart Fcitx5 Daemon
exec-once = fcitx5 -d --replace

# System Apps
exec-once = hypridle
exec-once = hyprsunset
exec-once = ~/.config/hypr/pipewire.sh
exec-once = sleep 1; qs &
exec-once = brightnessctl set 10%
exec-once = mako
exec-once = [workspace 9 silent;noanim] thunderbird

# =======================================================================================
# LOOK & FEEL (Catppuccin Mocha)
# =======================================================================================
general {
    border_size = 2
    col.active_border = rgb(89b4fa)
    col.inactive_border = rgb(313244)
    gaps_in = 3
    gaps_out = 3
    layout = dwindle
}

decoration {
    rounding = 0
    dim_inactive = false
    dim_strength = 0.7

    blur {
        enabled = true
        passes = 2
        size = 2
        new_optimizations = true
        xray = true
        ignore_opacity = true
    }

    shadow {
        enabled = false
        range = 8
        render_power = 3
    }
}

animations {
    enabled = true
    bezier = myBezier, 0.05, 0.9, 0.1, 1.05
    bezier = easeOutQuint, 0.23, 1, 0.32,1
    bezier = easeInOutCubic, 0.65, 0.05, 0.36, 1
    bezier = linear, 0, 0, 1, 1
    bezier = almostLinear, 0.5, 0.5, 0.75, 1.0
    bezier = quick, 0.15, 0, 0.1, 1

    animation = global, 1, 10, default
    animation = border, 1, 5.39, easeOutQuint
    animation = windows, 1, 4.79, easeOutQuint
    animation = windowsIn, 1, 4.1, easeOutQuint, popin 87%
    animation = windowsOut, 1, 1.49, linear, popin 87%
    animation = fadeIn, 1, 1.73, almostLinear
    animation = fadeOut, 1, 1.46, almostLinear
    animation = fade, 1, 3.03, quick
    animation = layers, 1, 3.81, easeOutQuint
    animation = layersIn, 1, 4, easeOutQuint, fade
    animation = layersOut, 1, 1.5, linear, fade
    animation = fadeLayersIn, 1, 1.79, almostLinear
    animation = fadeLayersOut, 1, 1.39, almostLinear
    animation = workspaces, 1, 1.94, almostLinear, fade
    animation = workspacesIn, 1, 1.21, almostLinear, fade
    animation = workspacesOut, 1, 1.94, almostLinear, fade
}

input {
    follow_mouse = 1
    kb_layout = us
    kb_options = ctrl:nocaps
    repeat_delay = 300
    repeat_rate = 30

    touchpad {
        disable_while_typing = true
        natural_scroll = true
    }
}

dwindle {
    force_split = 2
    preserve_split = true
    pseudotile = true
}

group {
    col.border_active = rgb(89b4fa)
    col.border_inactive = rgb(313244)
    groupbar {
        col.active = rgb(89b4fa)
        col.inactive = rgb(313244)
        render_titles = false
        text_color = rgb(cdd6f4)
    }
}

misc {
    background_color = rgb(1e1e2e)
    disable_hyprland_logo = false
    enable_anr_dialog = false
    disable_splash_rendering = true
    force_default_wallpaper = -1
}

xwayland {
    force_zero_scaling = true
}

# =======================================================================================
# WINDOW RULES
# =======================================================================================
# (Keep existing workspace rules as they are separate from windowrule syntax)
workspace = w[tv1]s[false], gapsout:0, gapsin:0
workspace = f[1]s[false], gapsout:0, gapsin:0


# Ignore maximize requests from all apps.
windowrule {
    name = suppress-maximize-events
    match:class = .*

    suppress_event = maximize
}

# Fix some dragging issues with XWayland
windowrule {
    name = fix-xwayland-drags
    match:class = ^$
    match:title = ^$
    match:xwayland = true
    match:float = true
    match:fullscreen = false
    match:pin = false

    no_focus = true
}

# Applications -> Workspaces
windowrule = match:class ^(thunderbird)$, workspace 9
windowrule = match:class ^(whatsapp-for-linux)$, workspace 8
windowrule = match:class ^(qBittorrent|org.qbittorrent.qBittorrent)$, workspace 7

# Steam
windowrule = match:class ^(steam)$, workspace 6
windowrule = match:title ^(Sign in to Steam)$, workspace 6
windowrule = match:class ^(steam)$, match:title ^(Special Offers)$, float on
windowrule = match:class ^(steam)$, match:title ^(Steam - News)$, float on, no_focus on
windowrule = match:class ^(steam)$, match:title ^(notificationtoasts_.*_desktop)$, no_focus on
windowrule = match:class ^(steam)$, match:title (^notificationtoasts.*), no_initial_focus on
windowrule = match:class ^(steam)$, match:title ^()$, no_focus on

# Media
windowrule = match:class ^(spotify)$, match:title ^(Spotify( (Premium|Free))?)$, workspace 5
windowrule = match:class (org.fooyin.fooyin), workspace 5
windowrule = match:class (tidal-hifi), workspace 5
windowrule = match:class ^(foobar2000.exe)$, workspace 5, tile on, no_anim on

# Communication
windowrule = match:class ^(org.telegram.desktop)$, workspace 4, no_anim on
windowrule = match:class ^(org.telegram.desktop)$, match:title ^(Media viewer)$, float on
windowrule = match:title ^(.*(Disc|ArmC|WebC)ord.*)$, workspace 3
windowrule = match:title ^(.*(Disc|WebC)ord.*)$, no_blur on, no_shadow on
windowrule = match:class ^(vesktop)$, workspace 3

# Browsers (Workspace, No Blur, No Shadow, Idle Inhibit Fullscreen)
windowrule = match:class ^(brave-browser|firefox|firefox-esr|floorp|zen|zen-beta|Chromium-browser|chromium-browser)$, workspace 2, no_blur on, no_shadow on, idle_inhibit fullscreen
# YouTube Idle Inhibit
windowrule = match:class ^(brave-browser|firefox|firefox-esr|floorp|zen|zen-beta|Chromium-browser|chromium-browser)$, match:title ^(.*YouTube.*)$, idle_inhibit focus

# Dev / Games
windowrule = match:class ^(jetbrains-.*)$, workspace 1, no_blur on, no_anim on
windowrule = match:class ^(Albion-Online)$, workspace 1

# Utilities / Floating
windowrule = match:title ^(Extension: (Bitwarden Password Manager)), float on
windowrule = match:title (^notificationtoasts.*), no_focus on
windowrule = match:class ^(xdg-desktop-portal-gtk)$, float on, no_blur on
windowrule = match:class .*, suppress_event maximize

# KeePassXC
windowrule = match:class ^(org.keepassxc.KeePassXC)$, no_blur on, no_anim on
windowrule = match:class ^(org.keepassxc.KeePassXC)$, match:title ^(Generate Password)$, float on
windowrule = match:class ^(org.keepassxc.KeePassXC)$, match:title ^(KeePassXC - Browser Access Request)$, float on

# =======================================================================================
# KEYBINDINGS
# =======================================================================================
$mod = SUPER

# Applications
bind = $mod, Return, exec, wezterm
bind = $mod SHIFT, E, exec, thunar
bind = $mod, M, exec, thunderbird
bind = $mod, P, exec, fuzzel
bind = $mod, D, exec, vesktop
bind = $mod, G, exec, firefox
bind = $mod SHIFT, G, exec, zen-browser

# Utils (Clipboard & Screenshots)
bind = $mod, O, exec, ~/.config/hypr/clipboard-picker.sh
bind = $mod SHIFT, O, exec, fuzzmoji

# Screenshot (Using your bash script logic)
bind = , print, exec, ~/.config/hypr/wl-ocr.sh
bind = CTRL, Print, exec, grimblast save area - | swappy -f -
bind = ALT, Print, exec, bash -c 'file="$HOME/Pictures/Screenshots/$(date +"%Y-%m-%d_%H-%M-%S").png"; grim -g "$(slurp)" "$file"; wl-copy < "$file"; notify-send "Screenshot taken" "Saved to $file" -i "$file"'

# Window Management
bind = $mod, X, exec, wleave
bind = $mod, W, killactive
bind = $mod, Q, togglespecialworkspace
bind = $mod SHIFT, Q, movetoworkspace, special
bind = $mod, F, fullscreen, 0
bind = $mod, Space, togglefloating
bind = $mod, R, togglegroup
bind = $mod SHIFT, J, changegroupactive, f
bind = $mod SHIFT, K, changegroupactive, b

# Focus & Move (Vim Style)
bind = $mod, h, movefocus, l
bind = $mod, l, movefocus, r
bind = $mod, k, movefocus, u
bind = $mod, j, movefocus, d

bind = $mod SHIFT, h, movewindow, l
bind = $mod SHIFT, l, movewindow, r
bind = $mod SHIFT, k, movewindow, u
bind = $mod SHIFT, j, movewindow, d

# Workspaces
bind = $mod, 1, workspace, 1
bind = $mod, 2, workspace, 2
bind = $mod, 3, workspace, 3
bind = $mod, 4, workspace, 4
bind = $mod, 5, workspace, 5
bind = $mod, 6, workspace, 6
bind = $mod, 7, workspace, 7
bind = $mod, 8, workspace, 8
bind = $mod, 9, workspace, 9
bind = $mod, 0, workspace, 10

bind = $mod SHIFT, 1, movetoworkspacesilent, 1
bind = $mod SHIFT, 2, movetoworkspacesilent, 2
bind = $mod SHIFT, 3, movetoworkspacesilent, 3
bind = $mod SHIFT, 4, movetoworkspacesilent, 4
bind = $mod SHIFT, 5, movetoworkspacesilent, 5
bind = $mod SHIFT, 6, movetoworkspacesilent, 6
bind = $mod SHIFT, 7, movetoworkspacesilent, 7
bind = $mod SHIFT, 8, movetoworkspacesilent, 8
bind = $mod SHIFT, 9, movetoworkspacesilent, 9
bind = $mod SHIFT, 0, movetoworkspacesilent, 10

# Media Keys (Wireplumber & Brightnessctl)
bindel = , XF86AudioRaiseVolume, exec, wpctl set-volume -l 1.5 @DEFAULT_AUDIO_SINK@ 5%+
bindel = , XF86AudioLowerVolume, exec, wpctl set-volume -l 1.5 @DEFAULT_AUDIO_SINK@ 5%-
bindel = , XF86AudioMute, exec, wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindel = , XF86AudioMicMute, exec, wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
bindel = , XF86MonBrightnessUp, exec, brightnessctl -e4 -n2 set 5%+
bindel = , XF86MonBrightnessDown, exec, brightnessctl -e4 -n2 set 5%-
bindl = , XF86AudioNext, exec, playerctl next
bindl = , XF86AudioPrev, exec, playerctl previous
bindl = , XF86AudioPlay, exec, playerctl play-pause
bindl = , XF86AudioPause, exec, playerctl play-pause

# Mouse
bindm = $mod, mouse:272, movewindow
bindm = $mod, mouse:273, resizewindow
